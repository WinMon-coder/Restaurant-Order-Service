{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport swal from \"sweetalert2\";\nwindow.swal = swal;\nimport utils from \"@/utils/utils\";\nimport SideBar from \"@/components/SideBar.vue\";\nexport default {\n  components: {\n    SideBar\n  },\n  data() {\n    return {\n      loginUser: {},\n      localDomain: utils.constant.localDomain,\n      updateDemo: {},\n      dialog: false,\n      changePw_dialog: false,\n      update_dialog: false,\n      poster: null,\n      posterPreviewPath: null,\n      errorAlert: false,\n      changePasswordForm: false,\n      show: false,\n      con_new_pwd: \"\",\n      new_pwd: \"\",\n      ori_id: \"\",\n      current_pwd: \"\",\n      errMsg: \"\"\n    };\n  },\n  async created() {\n    this.loginUser = this.$store.getters.loginUser;\n    await this.fetchUserProfile();\n  },\n  methods: {\n    backTo() {\n      this.$router.go(-1);\n    },\n    // Methods for Profile Update\n    editItem(loginUser) {\n      this.update_dialog = true;\n      this.updateDemo = loginUser;\n      this.poster = this.updateDemo.poster;\n      this.posterPreviewPath = this.updateDemo.posterPreviewPath;\n    },\n    closeUpdate() {\n      this.update_dialog = false;\n    },\n    onChangePoster(poster) {\n      this.posterPreviewPath = URL.createObjectURL(poster);\n    },\n    async updateUserProfile(id) {\n      this.errorAlert = false;\n\n      // Step 1 -> Update Poster\n      // Null -> Poster is not selected\n      if (this.updateDemo.poster != null) {\n        // Update Poster utils.http\n        const respPosterData = await utils.http.putMedia(\"/admin/file/update\", this.updateDemo.poster, this.updateDemo.poster.type, this.updateDemo.userPhoto);\n        if (respPosterData && respPosterData.status === 200) {\n          this.updateDemo.userPhoto = await respPosterData.text();\n        } else {\n          console.debug(\"Poster Update Failed\");\n        }\n      }\n      const resp = await utils.http.put(\"/user/profile/update/\" + id, {\n        userId: this.updateDemo.userId,\n        userFullName: this.updateDemo.userFullName,\n        userEmail: this.updateDemo.userEmail,\n        userPhone: this.updateDemo.userPhone,\n        userAddress: this.updateDemo.userAddress,\n        userPhoto: this.updateDemo.userPhoto\n      });\n      if (resp && resp.status === 200) {\n        this.update_dialog = false;\n        this.fetchUserProfile();\n        swal.fire({\n          position: \"top-end\",\n          icon: \"success\",\n          title: \"Update Profile Successfully\",\n          showConfirmButton: false,\n          timer: 1500\n        });\n      }\n    },\n    // Methods For Change Password\n    changePwd() {\n      this.changePw_dialog = true;\n    },\n    async submit() {\n      const resp = await utils.http.post(\"/user/change_password\", {\n        oriId: this.loginUser.userId,\n        currentPwd: this.current_pwd,\n        newPwd: this.new_pwd,\n        conNewPwd: this.con_new_pwd\n      });\n      if (resp.status === 200) {\n        this.$router.push({\n          path: \"/login\"\n        });\n      } else {\n        swal.fire({\n          icon: \"error\",\n          title: \"Oops...\",\n          text: \"Something went wrong!\"\n        });\n        const data = await resp.json();\n        this.errMsg = data.message;\n      }\n    },\n    clear() {\n      this.current_pwd = \"\";\n      this.new_pwd = \"\";\n      this.con_new_pwd = \"\";\n    },\n    async fetchUserProfile() {\n      const response = await utils.http.get(\"/user/profile?id=\" + this.loginUser.userId);\n      if (response) {\n        const data = await response.json();\n        if (data) this.loginUser = data;\n      } else {\n        console.log(\"sth wromg\");\n      }\n    }\n  }\n};","map":{"version":3,"mappings":";AAyWA;AACAA;AACA;AACA;AACA;EACAC;IACAC;EACA;EACAC;IACA;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;IACA;EACA;EAEA;IACA;IACA;EACA;EAEAC;IACAC;MACA;IACA;IACA;IACAC;MACA;MACA;MACA;MACA;IACA;IAEAC;MACA;IACA;IAEAC;MACA;IACA;IAEA;MACA;;MAEA;MACA;MACA;QACA;QACA,iDACA,sBACA,wBACA,6BACA,0BACA;QAEA;UACA;QACA;UACAC;QACA;MACA;MAEA;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;MACA;MAEA;QACA;QACA;QACAC;UACAC;UACAC;UACAC;UACAC;UACAC;QACA;MACA;IACA;IAEA;IACAC;MACA;IACA;IAEA;MACA;QACAC;QACAC;QACAC;QACAC;MACA;MACA;QACA;UAAAC;QAAA;MACA;QACAX;UACAE;UACAC;UACAS;QACA;QACA;QACA;MACA;IACA;IACAC;MACA;MACA;MACA;IACA;IACA;MACA,sCACA,4CACA;MACA;QACA;QACA;MACA;QACApB;MACA;IACA;EACA;AACA","names":["window","components","SideBar","data","loginUser","localDomain","updateDemo","dialog","changePw_dialog","update_dialog","poster","posterPreviewPath","errorAlert","changePasswordForm","show","con_new_pwd","new_pwd","ori_id","current_pwd","errMsg","methods","backTo","editItem","closeUpdate","onChangePoster","console","userId","userFullName","userEmail","userPhone","userAddress","userPhoto","swal","position","icon","title","showConfirmButton","timer","changePwd","oriId","currentPwd","newPwd","conNewPwd","path","text","clear"],"sourceRoot":"src/views","sources":["ProfileView.vue"],"sourcesContent":["<template>\n  <div>\n    <SideBar />\n    <!-- Profile View -->\n    <v-container class=\"mt-2 pt-6 pb-6\">\n      <v-row class=\"align-center\" justify=\"center\">\n        <v-spacer></v-spacer>\n        <v-col cols=\"12\" md=\"5\">\n          <v-card elevation=\"1\">\n            <v-toolbar color=\"#f6efef\">\n              <strong>Profile</strong>\n              <v-spacer></v-spacer>\n              <v-btn icon class=\"mr-4\" @click=\"editItem(loginUser)\">\n                <v-icon>manage_accounts </v-icon>\n              </v-btn>\n              <v-btn icon @click.prevent=\"changePwd()\">\n                <v-icon> password </v-icon>\n              </v-btn></v-toolbar\n            >\n            <v-img\n              v-if=\"loginUser.userPhoto != null\"\n              :src=\"localDomain + loginUser.userPhoto\"\n              height=\"250px\"\n              width=\"250px\"\n              dark\n              flat\n            >\n            </v-img>\n            <v-img\n              v-else\n              height=\"250px\"\n              width=\"250px\"\n              dark\n              flat\n              src=\"../assets/woman.png\"\n            />\n\n            <v-list two-line>\n              <v-list-item>\n                <v-list-item-icon>\n                  <v-icon color=\"primary\"> fa fa-user </v-icon>\n                </v-list-item-icon>\n\n                <v-list-item-content>\n                  <v-list-item-subtitle>Name</v-list-item-subtitle>\n                  <v-list-item-title\n                    ><strong>{{\n                      loginUser.userFullName\n                    }}</strong></v-list-item-title\n                  >\n                </v-list-item-content>\n              </v-list-item>\n\n              <v-divider inset></v-divider>\n              <v-list-item>\n                <v-list-item-icon>\n                  <v-icon color=\"primary\"> mdi-phone </v-icon>\n                </v-list-item-icon>\n\n                <v-list-item-content>\n                  <v-list-item-subtitle>Mobile</v-list-item-subtitle>\n                  <v-list-item-title\n                    ><strong>{{\n                      loginUser.userPhone\n                    }}</strong></v-list-item-title\n                  >\n                </v-list-item-content>\n              </v-list-item>\n\n              <v-divider inset></v-divider>\n\n              <v-list-item>\n                <v-list-item-icon>\n                  <v-icon color=\"primary\"> mdi-email </v-icon>\n                </v-list-item-icon>\n\n                <v-list-item-content>\n                  <v-list-item-subtitle>Email</v-list-item-subtitle>\n                  <v-list-item-title\n                    ><strong>{{\n                      loginUser.userEmail\n                    }}</strong></v-list-item-title\n                  >\n                </v-list-item-content>\n              </v-list-item>\n              <v-divider inset></v-divider>\n\n              <v-list-item>\n                <v-list-item-icon>\n                  <v-icon color=\"primary\"> fa fa-map-location</v-icon>\n                </v-list-item-icon>\n\n                <v-list-item-content>\n                  <v-list-item-subtitle>Address</v-list-item-subtitle>\n                  <v-list-item-title>\n                    <strong>{{\n                      loginUser.userAddress\n                    }}</strong></v-list-item-title\n                  >\n                </v-list-item-content>\n              </v-list-item>\n              <v-divider inset></v-divider>\n              <v-list-item>\n                <v-list-item-icon>\n                  <v-icon color=\"primary\"> fa fa-calendar </v-icon>\n                </v-list-item-icon>\n\n                <v-list-item-content>\n                  <v-list-item-subtitle>Join Date</v-list-item-subtitle>\n                  <v-list-item-title>\n                    <strong>{{\n                      loginUser.startJoinDate\n                    }}</strong></v-list-item-title\n                  >\n                </v-list-item-content>\n              </v-list-item>\n              <v-list-item>\n                <v-btn @click.prevent=\"backTo()\" class=\"ma-2\" color=\"primary \">\n                  <v-icon left> mdi-arrow-left </v-icon>Back\n                </v-btn>\n              </v-list-item>\n            </v-list>\n          </v-card>\n        </v-col>\n        <v-spacer></v-spacer>\n      </v-row>\n    </v-container>\n\n    <!-- ------------------------------------------------------------------------------------------------------ -->\n    <!-- Update Dialog Box-->\n    <v-dialog v-model=\"update_dialog\" max-width=\"500px\">\n      <v-card>\n        <v-card-title>\n          <h3>Edit User Profile</h3>\n        </v-card-title>\n        <v-card-text>\n          <v-container>\n            <!-- User Name -->\n            <v-row>\n              <v-col cols=\"12\" sm=\"6\" md=\"6\">\n                <v-text-field\n                  v-model=\"updateDemo.userFullName\"\n                  :rules=\"[\n                    (v) => !!v || 'Required',\n                    (v) =>\n                      (v && v.length <= 50) ||\n                      'Name must be less than 50 characters',\n                  ]\"\n                  label=\"Name\"\n                ></v-text-field>\n              </v-col>\n              <!-- User Role -->\n              <v-col cols=\"12\" sm=\"6\" md=\"6\">\n                <div\n                  v-for=\"(role, index) in this.loginUser.userRoles\"\n                  :key=\"index\"\n                >\n                  <v-text-field\n                    label=\"UserRole\"\n                    v-model=\"role.roleName\"\n                    disabled\n                  >\n                  </v-text-field>\n                </div>\n              </v-col>\n            </v-row>\n\n            <!-- User Email -->\n            <v-row>\n              <v-col cols=\"12\" sm=\"6\" md=\"6\">\n                <v-text-field\n                  label=\"Email\"\n                  v-model=\"updateDemo.userEmail\"\n                  :rules=\"[\n                    (v) => !!v || 'Required',\n                    (v) => /.+@.+\\..+/.test(v) || 'E-mail must be valid',\n                  ]\"\n                  type=\"text\"\n                  required\n                />\n              </v-col>\n              <!-- User Photo -->\n              <v-col cols=\"12\" sm=\"6\" md=\"6\">\n                <v-text-field\n                  v-model=\"updateDemo.userPhone\"\n                  :rules=\"[\n                    (v) => !!v || 'Required',\n                    (v) =>\n                      (v && v.length <= 11) ||\n                      'Phone number must be less than 11 characters',\n                  ]\"\n                  label=\"Phone no.\"\n                ></v-text-field>\n              </v-col>\n            </v-row>\n\n            <!-- User Address -->\n            <v-row>\n              <v-col cols=\"12\" sm=\"6\" md=\"6\">\n                <v-text-field\n                  v-model=\"updateDemo.userAddress\"\n                  :rules=\"[\n                    (v) => !!v || 'Required',\n                    (v) =>\n                      (v && v.length <= 50) ||\n                      'Address must be less than 50 characters',\n                  ]\"\n                  label=\"Address\"\n                ></v-text-field>\n              </v-col>\n              <v-col cols=\"12\" sm=\"6\">\n                <v-file-input\n                  v-model=\"updateDemo.poster\"\n                  label=\"Photo\"\n                  show-size\n                  prepend-icon=\"mdi-camera\"\n                  placeholder=\"Choose Poster Image\"\n                  accept=\"image/png, image/jpeg\"\n                  :rules=\"[\n                    (v) => !!v || 'Required',\n                    (v) =>\n                      !v ||\n                      v.size < 10000000 ||\n                      'Image size should be less than 10 MB!',\n                  ]\"\n                  @change=\"onChangePoster\"\n                ></v-file-input>\n              </v-col>\n            </v-row>\n\n            <!-- -------------****** poster start ******-------------------------- -->\n\n            <!-- Poster is not selected (null) -->\n            <v-row>\n              <v-img\n                v-if=\"posterPreviewPath == null\"\n                :src=\"localDomain + updateDemo.userPhoto\"\n                width=\"200\"\n                height=\"150\"\n                contain\n              >\n              </v-img>\n              <!-- Poster is selected (not null) -->\n              <v-img\n                v-if=\"posterPreviewPath != null\"\n                :src=\"posterPreviewPath\"\n                width=\"200\"\n                height=\"150\"\n                contain\n              >\n              </v-img>\n            </v-row>\n            <!-- -------------****** poster end ******-------------------------- -->\n          </v-container>\n        </v-card-text>\n        <v-card-actions>\n          <v-spacer></v-spacer>\n          <v-btn class=\"mb-2 widthoutupercase\" text @click=\"closeUpdate\"\n            >Cancel</v-btn\n          >\n          <v-btn\n            color=\"primary\"\n            class=\"mb-2 widthoutupercase white--text\"\n            @click=\"updateUserProfile(loginUser.userId)\"\n          >\n            Update</v-btn\n          >\n        </v-card-actions>\n        <v-alert class=\"mt-3\" v-show=\"errorAlert\" dense type=\"error\">\n          Update Fail!!\n        </v-alert>\n      </v-card>\n    </v-dialog>\n    <!-- ------------------------------------------------------------------------------------------------------ -->\n    <!-- Change Password Dialog Box-->\n    <v-dialog v-model=\"changePw_dialog\" max-width=\"500px\">\n      <v-card>\n        <v-card-title>\n          <h3>Change Password</h3>\n        </v-card-title>\n        <v-card-text>\n          <v-container>\n            <!-- Current Password -->\n            <v-text-field v-show=\"false\" v-model=\"ori_id\" hidden></v-text-field>\n            <v-row>\n              <v-col>\n                <v-text-field\n                  v-model=\"current_pwd\"\n                  :rules=\"[(v) => !!v || 'Required']\"\n                  label=\"Current Password\"\n                  required\n                >\n                </v-text-field>\n              </v-col>\n            </v-row>\n\n            <!-- New Password -->\n            <v-row>\n              <v-col>\n                <v-text-field\n                  v-model=\"new_pwd\"\n                  :rules=\"[\n                    (v) => !!v || 'Required',\n                    (v) =>\n                      (v && v.length >= 3) ||\n                      'Password must be greater than 3 characters',\n                    (v) =>\n                      (v && v.length >= 3 && v.length <= 10) ||\n                      'Password must be less than 10 characters',\n                  ]\"\n                  label=\"New Password\"\n                  required\n                >\n                </v-text-field>\n              </v-col>\n            </v-row>\n\n            <!-- Confirm New Password -->\n            <v-row>\n              <v-col>\n                <v-text-field\n                  v-model=\"con_new_pwd\"\n                  :rules=\"[\n                    (v) => !!v || 'Required',\n                    (v) =>\n                      (v && v.length >= 3) ||\n                      'Password must be greater than 3 characters',\n                    (v) =>\n                      (v && v.length >= 3 && v.length <= 10) ||\n                      'Password must be less than 10 characters',\n                  ]\"\n                  label=\"Confirm New Password\"\n                  required\n                >\n                </v-text-field>\n              </v-col>\n            </v-row>\n          </v-container>\n        </v-card-text>\n        <v-alert class=\"mt-3\" v-show=\"errorAlert\" dense type=\"error\">\n          {{ errMsg }}\n        </v-alert>\n        <v-card-actions>\n          <v-spacer></v-spacer>\n\n          <v-btn class=\"mb-2 widthoutupercase\" text @click=\"clear\">Clear</v-btn>\n          <v-btn\n            color=\"primary\"\n            class=\"mb-2 widthoutupercase white--text\"\n            @click=\"submit()\"\n          >\n            Submit</v-btn\n          >\n          <!-- Error Alert -->\n        </v-card-actions>\n      </v-card>\n    </v-dialog>\n  </div>\n</template>\n\n<script>\nimport swal from \"sweetalert2\";\nwindow.swal = swal;\nimport utils from \"@/utils/utils\";\nimport SideBar from \"@/components/SideBar.vue\";\nexport default {\n  components: {\n    SideBar,\n  },\n  data() {\n    return {\n      loginUser: {},\n      localDomain: utils.constant.localDomain,\n      updateDemo: {},\n      dialog: false,\n      changePw_dialog: false,\n      update_dialog: false,\n      poster: null,\n      posterPreviewPath: null,\n      errorAlert: false,\n      changePasswordForm: false,\n      show: false,\n      con_new_pwd: \"\",\n      new_pwd: \"\",\n      ori_id: \"\",\n      current_pwd: \"\",\n      errMsg: \"\",\n    };\n  },\n\n  async created() {\n    this.loginUser = this.$store.getters.loginUser;\n    await this.fetchUserProfile();\n  },\n\n  methods: {\n    backTo() {\n      this.$router.go(-1);\n    },\n    // Methods for Profile Update\n    editItem(loginUser) {\n      this.update_dialog = true;\n      this.updateDemo = loginUser;\n      this.poster = this.updateDemo.poster;\n      this.posterPreviewPath = this.updateDemo.posterPreviewPath;\n    },\n\n    closeUpdate() {\n      this.update_dialog = false;\n    },\n\n    onChangePoster(poster) {\n      this.posterPreviewPath = URL.createObjectURL(poster);\n    },\n\n    async updateUserProfile(id) {\n      this.errorAlert = false;\n\n      // Step 1 -> Update Poster\n      // Null -> Poster is not selected\n      if (this.updateDemo.poster != null) {\n        // Update Poster utils.http\n        const respPosterData = await utils.http.putMedia(\n          \"/admin/file/update\",\n          this.updateDemo.poster,\n          this.updateDemo.poster.type,\n          this.updateDemo.userPhoto\n        );\n\n        if (respPosterData && respPosterData.status === 200) {\n          this.updateDemo.userPhoto = await respPosterData.text();\n        } else {\n          console.debug(\"Poster Update Failed\");\n        }\n      }\n\n      const resp = await utils.http.put(\"/user/profile/update/\" + id, {\n        userId: this.updateDemo.userId,\n        userFullName: this.updateDemo.userFullName,\n        userEmail: this.updateDemo.userEmail,\n        userPhone: this.updateDemo.userPhone,\n        userAddress: this.updateDemo.userAddress,\n        userPhoto: this.updateDemo.userPhoto,\n      });\n\n      if (resp && resp.status === 200) {\n        this.update_dialog = false;\n        this.fetchUserProfile();\n        swal.fire({\n          position: \"top-end\",\n          icon: \"success\",\n          title: \"Update Profile Successfully\",\n          showConfirmButton: false,\n          timer: 1500,\n        });\n      }\n    },\n\n    // Methods For Change Password\n    changePwd() {\n      this.changePw_dialog = true;\n    },\n\n    async submit() {\n      const resp = await utils.http.post(\"/user/change_password\", {\n        oriId: this.loginUser.userId,\n        currentPwd: this.current_pwd,\n        newPwd: this.new_pwd,\n        conNewPwd: this.con_new_pwd,\n      });\n      if (resp.status === 200) {\n        this.$router.push({ path: \"/login\" });\n      } else {\n        swal.fire({\n          icon: \"error\",\n          title: \"Oops...\",\n          text: \"Something went wrong!\",\n        });\n        const data = await resp.json();\n        this.errMsg = data.message;\n      }\n    },\n    clear() {\n      this.current_pwd = \"\";\n      this.new_pwd = \"\";\n      this.con_new_pwd = \"\";\n    },\n    async fetchUserProfile() {\n      const response = await utils.http.get(\n        \"/user/profile?id=\" + this.loginUser.userId\n      );\n      if (response) {\n        const data = await response.json();\n        if (data) this.loginUser = data;\n      } else {\n        console.log(\"sth wromg\");\n      }\n    },\n  },\n};\n</script>\n\n<style></style>\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}